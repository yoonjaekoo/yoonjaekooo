<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>클릭 횟수 게임</title>
<style>
  body { text-align: center; font-family: sans-serif; margin-top: 50px; }
  button { font-size: 24px; padding: 20px 40px; cursor: pointer; }
  #count, #best { font-size: 30px; margin-top: 20px; }
</style>
</head>
<body>

<h1>클릭 횟수 게임</h1>
<button id="click-btn">누를 때마다 +1</button>
<div id="count">현재 클릭: 0</div>
<div id="best">최고 기록: 0</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
  const supabaseUrl = 'https://koo131207.supabase.co'
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im96ZnNwZHVsemtjamZ1aHhweGRsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyNDMyODMsImV4cCI6MjA2OTgxOTI4M30.aWNRfnlcgtXwJPX4qYsHzIbbX7E_J9Zq_xsLRt_z2Es';
  const supabase = supabase.createClient(supabaseUrl, supabaseKey)

  let count = 0;
  const btn = document.getElementById('click-btn');
  const countDiv = document.getElementById('count');
  const bestDiv = document.getElementById('best');

  async function fetchBest() {
    const { data, error } = await supabase
      .from('clicks')
      .select('count')
      .eq('id', true)
      .single()

    if (!error && data) {
      bestDiv.textContent = '최고 기록: ' + data.count
    }
  }

  fetchBest();

  btn.onclick = async () => {
    count++;
    countDiv.textContent = '현재 클릭: ' + count;

    const { data, error } = await supabase.rpc('increment_click')
    if (error) {
      console.log('Error:', error)
      return;
    }

    // 클릭 후 최신 값 다시 가져오기
    fetchBest();
  }
</script>

</body>
</html>
